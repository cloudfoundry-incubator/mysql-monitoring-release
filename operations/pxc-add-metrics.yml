---
- type: replace
  path: /releases/name=mysql-monitoring?
  value:
    name: mysql-monitoring
    version: latest

- type: replace
  path: /releases/name=loggregator?
  value:
    name: loggregator
    version: latest

- type: replace
  path: /instance_groups/name=mysql/jobs/-
  value:
    name: mysql-metrics
    release: mysql-monitoring
    properties:
      mysql-metrics:
        host: localhost
        password: ((mysql_metrics_password))
        tls:
          ca: ((loggregator_tls_ca_cert))
          cert: ((loggregator_tls_metron_cert))
          key: ((loggregator_tls_metron_key))


- type: replace
  path: /instance_groups/name=mysql/jobs/name=pxc-mysql/properties/seeded_databases?/-
  value:
    name: metrics_db
    username: mysql-metrics
    password: ((mysql_metrics_password))

- type: replace
  path: /instance_groups/name=mysql/jobs/name=pxc-mysql/properties/server_audit_excluded_users?/-
  value: mysql-metrics

- type: replace
  path: /instance_groups/name=mysql/jobs/-
  value:
    name: metron_agent
    release: loggregator
    consumes:
      doppler: { deployment: cf }
    properties:
      loggregator:
        tls:
          ca_cert: ((loggregator_tls_ca_cert))
          metron:
            cert: ((loggregator_tls_metron_cert))
            key: ((loggregator_tls_metron_key))
      metron_agent:
        bosh_dns: true
        deployment: ((metron_agent_deployment))

- type: replace
  path: /variables/-
  value:
    name: mysql_metrics_password
    type: password
