<%=

config = {
  instance_id: spec.id,
  username: p('mysql-metrics.username'),
  password: p('mysql-metrics.password'),
  pidfile: '/var/vcap/sys/run/mysql-metrics/mysql-metrics.pid',
  metrics_frequency: p('mysql-metrics.metrics_frequency'),
  origin: p('mysql-metrics.origin'),
  emit_disk_metrics: p('mysql-metrics.disk_metrics_enabled'),
  emit_mysql_metrics: p('mysql-metrics.mysql_metrics_enabled'),
  emit_leader_follower_metrics: p('mysql-metrics.leader_follower_enabled'),
  emit_galera_metrics: p('mysql-metrics.galera_metrics_enabled'),
  heartbeat_database: p('mysql-metrics.heartbeat_database'),
  heartbeat_table: p('mysql-metrics.heartbeat_table')
}
if config[:metrics_frequency] < p('mysql-metrics.minimum_metrics_frequency')
  raise 'metrics_frequency < minimum_metrics_frequency: collecting metrics at this rate is not advised'
end

# JSON is valid yaml
JSON.pretty_generate(config)

%>

