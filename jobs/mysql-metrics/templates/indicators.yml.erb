---
apiVersion: v0
product:
  name: mysql-pxc
  version: v2.5

metadata:
  deployment: <%= spec.deployment %>
  source_id: <%= p("mysql-metrics.source_id") %>
  origin: <%= p("mysql-metrics.origin") %>

indicators:
- name: mysql_availability
  promql:  _$origin_available{source_id="$source_id", deployment="$deployment"}
  thresholds:
  - level: critical
    lt: 1
  alert:
    for: 5m
  documentation:
    title: MySQL Server Availability
    description: A boolean value that indicates whether the MySQL process is running or not.
    recommendedResponse: Run mysql-diag and check the MySQL Server logs for errors.
- name: mysql_galera_wsrep_ready
  promql:  _$origin_galera_wsrep_ready{source_id="$source_id", deployment="$deployment"}
  thresholds:
  - level: critical
    eq: 0
  - level: warning
    lt: 1
  alert:
    for: 5m
  documentation:
    title: Galera Cluster Node Readiness
    description: "Shows whether each cluster node can accept queries. Returns only 0 or 1. When this metric is 0, almost all queries to that node fail with the error:
ERROR 1047 (08501) Unknown Command"
    recommendedResponse: "Run mysql-diag and check the MySQL Server logs for errors. \nMake sure there has been no infrastructure event that affects intra-cluster communication. \nEnsure that wsrep_ready has not been set to off by using the query: SHOW STATUS LIKE 'wsrep_ready';"
