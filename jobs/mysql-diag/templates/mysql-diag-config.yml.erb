<%=

config = {
  canary: {
    # recycle the same username/pw for basic auth, keeps the number of credentials down
    username: link('replication-canary').p('mysql-monitoring.replication-canary.canary_username'),
    password: link('replication-canary').p('mysql-monitoring.replication-canary.canary_password'),
    api_port: link('replication-canary').p('mysql-monitoring.replication-canary.api_port')
  },
  nodes: link('mysql').instances.map { |m|
      {
        username: link('replication-canary').p('mysql-monitoring.replication-canary.canary_username'),
        password: link('replication-canary').p('mysql-monitoring.replication-canary.canary_password'),
        host: m.address,
        mysql_port: p('cf_mysql.mysql.port'),
        name: m.name,
        uuid: m.id
      }
    }
  }

# JSON is valid yaml
JSON.pretty_generate(config)

%>
